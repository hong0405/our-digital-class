<!-- dashboard.html (ìˆ˜ì •ëœ ì™„ì „ ì‘ë™ ë²„ì „) -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ëŒ€ì‹œë³´ë“œ - ë””ì§€í„¸ ë‚˜ëˆ”êµì‹¤</title>
  <!-- Firebase SDK (compat ë²„ì „ ì‚¬ìš©) -->
  <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-storage-compat.js"></script>

  <!-- ì„¤ì • ë° ê¸°ëŠ¥ ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="firebase.js"></script>
  <script>
    firebase.auth().onAuthStateChanged((user) => {
      if (!user) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        window.location.href = 'login.html';
      } else {
        document.getElementById('welcome').innerText = `${user.email}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!`;
        listFiles();
      }
    });

    function logout() {
      firebase.auth().signOut();
    }

    async function uploadFile() {
      const user = firebase.auth().currentUser;
      const file = document.getElementById('fileInput').files[0];
      if (!user || !file) return alert('ë¡œê·¸ì¸ ë˜ëŠ” íŒŒì¼ì„ í™•ì¸í•˜ì„¸ìš”.');

      const storageRef = firebase.storage().ref();
      const fileRef = storageRef.child(`uploads/${user.uid}/${file.name}`);

      try {
        await fileRef.put(file);
        alert('âœ… ì—…ë¡œë“œ ì™„ë£Œ!');
        document.getElementById('fileInput').value = '';
        await listFiles();
      } catch (error) {
        alert('âŒ ì—…ë¡œë“œ ì‹¤íŒ¨: ' + error.message);
      }
    }

    async function listFiles() {
      const user = firebase.auth().currentUser;
      if (!user) return;

      const listRef = firebase.storage().ref(`uploads/${user.uid}`);
      const result = await listRef.listAll();
      const fileList = document.getElementById('fileList');
      fileList.innerHTML = '';

      for (const itemRef of result.items) {
        const url = await itemRef.getDownloadURL();
        const li = document.createElement('li');
        li.innerHTML = `<a href="${url}" target="_blank">${itemRef.name}</a>`;
        fileList.appendChild(li);
      }
    }
  </script>

  <style>
    body { font-family: sans-serif; background: #f9f9f9; text-align: center; padding: 2rem; }
    .card { background: white; padding: 2rem; margin: auto; max-width: 600px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    input[type="file"] { margin-top: 1rem; }
    ul { list-style: none; padding: 0; }
    li { margin: 0.5rem 0; }
    button { padding: 0.5rem 1rem; margin-top: 1rem; }
  </style>
</head>
<body>
  <div class="card">
    <h1 id="welcome">ì‚¬ìš©ìë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!</h1>
    <input type="file" id="fileInput" />
    <button onclick="uploadFile()">ğŸ“¤ ì—…ë¡œë“œ</button>
    <h2>ì œì¶œí•œ íŒŒì¼ ëª©ë¡</h2>
    <ul id="fileList"></ul>
    <button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
  </div>
</body>
</html>